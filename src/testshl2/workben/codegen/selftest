#!/bin/csh

echo "========== Generate code =========="
echo

perl ../../source/codegen/codegen.pl test.job

echo
echo "========== check files =========="
echo

./checkfile makefile.new
./checkfile export.exp
./checkfile skeleton.cxx
./checkfile nomethod.cxx

echo
echo "========== backup makefile =========="
echo

# backup original makefile
mv makefile.mk makefile.mk_orig
mv makefile.new makefile.mk

echo
echo "========== build new sources =========="
echo

dmake debug=t

echo
echo "========== call testshl2 =========="
echo


if ( -e ../../${INPATH}/bin/testshl2 ) then
    ../../${INPATH}/bin/testshl2 -jobonly test.job    

    echo 
    ../../${INPATH}/bin/testshl2 ../../${INPATH}/lib/libtest.so
else
    echo "testshl2 doesn't exist, test canceled."
endif

echo
echo "========== cleanup =========="
echo

./cleanup
